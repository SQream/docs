<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="mp-topic">
    <head>
        <link href="../../Resources/Table Styles/DefaultTable.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1>Tuning OS parameters</h1>
        <p>You should tune the following OS parameters to optimize performance:</p>
        <ul>
            <li><a href="#Number">Number of open files</a>
            </li>
            <li><a href="#Tuning">Tuning kernel parameters</a>
            </li>
            <li><a href="#Disablin">Disabling Transparent Hugepages</a>
            </li>
            <li><a href="#CPU">CPU Throttling</a>
            </li>
        </ul>
        <h3><a name="Number"></a>Number of open files</h3>
        <p>On Linux systems, persistent limits can be set for a particular user by editing the <span class="emphasis">/etc/security/limits.conf</span> file. To set the maximum number of open files for the sqream user to 500,000, run the following command to edit this <span class="emphasis">limits.conf file.</span></p>
        <p class="code"># echo -e "sqream soft nproc 500000\nsqream hard nproc 500000\nsqream soft nofile 500000\nsqream hard nofile 500000</p>
        <div class="tip">
            <p>In most cases this command must be run under 'root'</p>
        </div>
        <h5>Ubuntu and limits.conf</h5>
        <p>Ubuntu ignores the <span class="emphasis">limits.conf</span> file for processes started by init.d.</p>
        <p class="toDo">To enable the limits.conf file, edit /etc/pam.d/su and uncomment the following line:</p>
        <p class="code"># session required pam_limits.so</p>
        <h3><a name="Tuning"></a>Tuning kernel parameters</h3>
        <p>Several kernel parameters can be tuned for better performance.</p>
        <p class="toDo">Run the sysctl command to modify kernel parameters</p>
        <p class="code"># sudo echo -e "vm.dirty_background_ratio = 5 \n vm.dirty_ratio = 10 \n vm.swappiness = 10 \n vm.zone_reclaim_mode = 7 \n vm.vfs_cache_pressure = 200 \n"  &gt;&gt; /etc/sysctl.conf</p>
        <p class="tableHeader">Kernel Parameters</p>
        <table style="width: 100%; mc-table-style: url('../../Resources/Table Styles/DefaultTable.css'); margin-left: 0; margin-right: auto;" class="TableStyle-Default_Table" cellspacing="0">
            <col class="TableStyle-Default_Table-Column-Column1" style="width: 30%;" />
            <col class="TableStyle-Default_Table-Column-Column1" style="width: 70%;" />
            <thead>
                <tr class="TableStyle-Default_Table-Head-Header1">
                    <th class="TableStyle-Default_Table-HeadE-Column1-Header1">
                        <p class="tableHeading">Parameter</p>
                    </th>
                    <th class="TableStyle-Default_Table-HeadD-Column1-Header1">
                        <p class="tableHeading">Explanation</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1">
                        <p class="tableBody">vm.vfs_cache_pressure</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p class="tableBody">Controls the tendency of the kernel to reclaim the memory used for VFS caches versus pagecache and swap. Increasing this value increases the rate at which VFS caches are reclaimed.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body2">
                        <p class="tableBody">vm.dirty_background_ratio</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body2">
                        <p class="tableBody">Percentage of total system memory. The number of pages at which the pdflush background writeback daemon will start writing out dirty data. However, for a fast RAID-based disk system this may cause large flushes of dirty memory pages. Larger values will result in less frequent flushes.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1">
                        <p class="tableBody">vm.swappiness</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p class="tableBody">Defines how aggressively memory pages are swapped to disk. If you do not want swapping, then lower this value. However, if your system process sleeps for a long time you may benefit from an aggressive swapping behavior by increasing this value. You can change swappiness behavior by increasing or decreasing the value.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body2">
                        <p class="tableBody">vm.dirty_ratio</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body2">
                        <p class="tableBody">Percentage of total system memory. The number of pages at which a process that is generating disk writes will itself start writing out dirty data. This is the ratio at which dirty pages created by application disk writes will be flushed out to disk. A value of 40 means that data will be written into system memory until the file system cache has a size of 40% of the server RAM. So if the server has 12GB of RAM, data will be written into system memory until the file system cache has a size of 4.8G.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1">
                        <p class="tableBody">vm.zone_reclaim_mode
                        </p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p class="tableBody">Defines how aggressively memory will be reclaimed when a zone runs out of memory. Allowing zone reclaim to write out pages stops processes that are writing large amounts of data from dirtying pages on other nodes.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyB-Column1-Body2">
                        <p class="tableBody">fs.file-max</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyA-Column1-Body2">
                        <p class="tableBody">file-max is the maximum number of File Descriptors (FD) enforced on a kernel level that cannot be exceeded by all combined processes without increasing. The <span class="strong">ulimit</span> is enforced on a process level, which can be less than the file-max.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p class="code"># sudo sysctl -a |grep fs.file-max</p>
        <p class="toDo">If the value of fs.file-max is less than 500000:</p>
        <ol>
            <li>Run the following command to edit the <span class="emphasis">/etc/sysctl.conf</span> configuration file:</li>
            <p class="code"># sudo vim /etc/sysctl.conf</p>
            <li>Add the following line at end:</li>
            <p class="code">fs.file-max=500000</p>
            <li>Run the following command for the change to take effect.</li>
            <p class="code"># sudo sysctl -p</p>
        </ol>
        <h3><a name="Disablin"></a>Disabling Transparent Hugepages</h3>
        <p>Transparent Huge Pages are the kernel’s attempt to reduce the overhead of the Translation Lookaside Buffer (TLB) lookups by increasing the size of memory pages. This setting is enabled by default, but can lead to sparse memory usage and decreased performance.</p>
        <p class="toDo">Run this command to disable Transparent Huge Pages.</p>
        <p class="code"># echo "never" &gt; /sys/kernel/mm/transparent_hugepage/enabled</p>
        <h3><a name="CPU"></a>CPU Throttling</h3>
        <p class="toDo">For optimal performance, the power scaling setting for all processor governors should be set to 'performance'.</p>
        <p class="code">sudo tuned-adm profile throughput-performance</p>
    </body>
</html>