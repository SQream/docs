<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="mc-master-page: url('..\..\..\Resources\MasterPages\Guides.flmsp');">
    <head>
        <link href="../../../Resources/Table Styles/DefaultTable.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h2>Installation procedure</h2>
        <h3>Download and run your Docker installer</h3>
        <h4>Docker CE =18.03</h4>
        <h5>CentOS:</h5>
        <p><a href="https://docs.docker.com/install/linux/docker-ce/centos/">https://docs.docker.com/install/linux/docker-ce/centos/</a>
        </p>
        <h4>Nvidia Docker2</h4>
        <h5>CentOS:</h5>
        <p><a href="https://github.com/NVIDIA/nvidia-docker">https://github.com/NVIDIA/nvidia-docker</a>
        </p>
        <p>CentOS 7 (docker-ce), RHEL 7.4/7.5 (docker-ce), Amazon Linux 1/2</p>
        <h3>Prepare the environment</h3>
        <p>SQream Docker runs on the 'docker' user.</p>
        <p>In order for sqream to be able to read and write its resources, it's important that the docker user has r/w access to the following directories:</p>
        <ul>
            <li>Log (default: <span class="emphasis">/var/log/sqream/</span>)</li>
            <li>Configuration (default: <span class="emphasis">/etc/sqream/</span>)</li>
            <li>Cluster (where sqream writes the DB system. Example <span class="emphasis">/mnt/sqreamdb</span>)</li>
            <li>Ingest (where the data that should be loaded is located. Example <span class="emphasis">/mnt/data_source/</span>)</li>
        </ul>
        <p>If running SQream from a user different then the docker user, the local user should be added to docker group:</p>
        <div class="code">
            <p>sudo usermod -aG docker $USER</p>
        </div>
        <p>Logout or restart your ssh session.</p>
        <h3>Download the SQream package</h3>
        <p>Make sure your SQream package is downloaded and untarred. (See <a href="1_Installing_SQream_via_Docker.htm#Before">Before you start</a>.)</p>
        <h3>Configure your environment</h3>
        <p>Run the commands below from the place where you put the package directory, for example <span class="emphasis">/home/sqream/sqream-console-package/</span> under <span class="strong">sudo</span>:</p>
        <div class="code">
            <p>./sqream-install -i -f -c -v -l -d</p>
        </div>
        <h4>Flags</h4>
        <table style="mc-table-style: url('../../../Resources/Table Styles/DefaultTable.css');" class="TableStyle-Default_Table" cellspacing="0">
            <thead>
                <tr class="TableStyle-Default_Table-Head-Header1">
                    <th class="TableStyle-Default_Table-HeadE-Column1-Header1">
                        <p>Flag</p>
                    </th>
                    <th class="TableStyle-Default_Table-HeadD-Column1-Header1">
                        <p>Explanation</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1" style="font-weight: bold;">
                        <p>I</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p>Loads all the software from
 hidden folder ".docker" <span class="emphasis">(see <a href="#Mandator">Comment #‎3</a> below).</span></p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body2" style="font-weight: bold;">
                        <p>f</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body2">
                        <p>Overwrite if folder already exists, </p>
                        <p><span class="strong">Using f will overwrite all files in
 mounted directories</span>
                        </p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1" style="font-weight: bold;">
                        <p>c</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p>Path <span class="emphasis">(see <a href="#If">Comment #‎1</a> below)</span> where to
 write/read SQream configuration files from. (default: <span class="emphasis">/etc/sqream/</span>). </p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body2" style="font-weight: bold;">
                        <p>v</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body2">
                        <p>Location of sqream cluster. If cluster doesn’t exist it would be created, mounted if exists
  <span class="emphasis">(see <a href="#Mandator">Comment #‎3</a> below).</span></p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1" style="font-weight: bold;">
                        <p>l</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p>Location of  SQream system startup logs (which contain
 startup logs and docker logs, Default: <span class="emphasis">/var/log/sqream/)</span>.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body2" style="font-weight: bold;">
                        <p>d</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body2">
                        <p>The folder where the customer currently has data to
 import/copy to sqream.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body1">
                    <td class="TableStyle-Default_Table-BodyE-Column1-Body1" style="font-weight: bold;">
                        <p>r</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyD-Column1-Body1">
                        <p>Reset system configuration, run
 without any other variables.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Default_Table-Body-Body2">
                    <td class="TableStyle-Default_Table-BodyB-Column1-Body2" style="font-weight: bold;">
                        <p>h</p>
                    </td>
                    <td class="TableStyle-Default_Table-BodyA-Column1-Body2">
                        <p>Help, shows available flags</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Comments</h5>
        <ol>
            <li>
                <p><a name="If"></a>If you are installing docker on a server that already works with SQream do not use the default path. (See Flag – <span class="strong">c</span>)</p>
            </li>
            <li>
                <p>If you are not running the sqream-install for the first time, please verify that all SQream docker containers are stopped.</p>
            </li>
            <li>
                <p><a name="Mandator"></a>Mandatory flags for first run: (see flags –<span class="strong">i</span> and –<span class="strong">v</span>)</p>
                <div class="code">
                    <p>sudo ./sqream-install -i -v /sqreamcluster</p>
                </div>
            </li>
            <li>
                <p>The “-<span class="strong">d</span>” flag is not required when installing sqream, however if the flag is not used, SQream will not be able to read from any folder except the SQream Cluster.</p>
                <p>If you did not use the “-<span class="strong">d</span>” flag in the original installation, you can run <span class="strong">sqream-install</span> with the -<span class="strong">d</span> flag at any time. Note that you will need to stop and start the <span class="strong">sqream worker</span> for the change to take effect.</p>
                <h5>Example for best practice:</h5>
                <div class="code">
                    <p>sudo ./sqream-install -i -c /etc/sqream -v /home/sqream/sqreamdb -l /var/log/sqream -d /home/sqream/data_ingest</p>
                </div>
                <h5>Setting  data import folder example</h5>
                <div class="code">
                    <p>sudo ./sqream-install -d /home/sqream/data_in</p>
                </div>
            </li>
        </ol>
        <h3>Start the SQream Console</h3>
        <p>The sqream console allows the SQream DBA to manage and monitor SQream dockers.</p>
        <div class="code">
            <p>./sqream-console</p>
        </div>
        <p class="note">Only a single sqream console instance at a time can be open on a server.</p>
        <h4>Console Commands</h4>
        <h5>Metadata &amp; Picker</h5>
        <p>Start metadata and picker</p>
        <p><span class="codeCH">sqream master --start --single-host</span>
        </p>
        <div class="code">
            <p>sqream-console&gt;sqream master --start --single-host</p>
            <p>sqream_single_host_master is up and listening on ports: 3105, 3108</p>
        </div>
        <h5>SQreamd</h5>
        <p>Start and stop SQream</p>
        <p><span class="codeCH">sqream worker --start X</span> (X is the number of GPUs you want to bind).</p>
        <div class="code">
            <p>sqream-console&gt;sqream worker --start 2</p>
            <p>started sqream_single_host_worker_0 on port 5000, allocated gpu: 0</p>
            <p>started sqream_single_host_worker_1 on port 5001, allocated gpu: 1</p>
        </div>
        <p><span class="codeCH">sqream worker --stop &lt;full worker name&gt;</span> ( run sqream master --list to get the worker name).</p>
        <div class="code">
            <p>sqream-console&gt;sqream worker --start 2</p>
            <p>started sqream_single_host_worker_0 on port 5000, allocated gpu: 0</p>
            <p>started sqream_single_host_worker_1 on port 5001, allocated gpu: 1</p>
        </div>
        <p><span class="codeCH">sqream worker --stop &lt;full worker name&gt;</span> ( run sqream master --list to get the worker name).</p>
        <div class="code">
            <p>sqream-console&gt;sqream worker --stop sqream_single_host_worker_0</p>
            <p>stopped sqream_single_host_worker_0</p>
        </div>
        <h5>List running services</h5>
        <p>View all running SQream services.</p>
        <p><span class="codeCH">sqream master --list</span>
        </p>
        <div class="code">
            <p>sqream-console&gt;sqream master --list</p>
            <p>container name: sqream_single_host_worker_0, container id: c919e8fb78c8</p>
            <p>container name: sqream_single_host_master, container id: ea7eef80e038</p>
        </div>
        <h5>Stop running services (Master and Workers)</h5>
        <p>Stop all running SQream services</p>
        <p><span class="codeCH">sqream master --stop</span>
        </p>
        <div class="code">
            <p>sqream-console&gt;sqream master --stop</p>
            <p>stopped container sqream_single_host_worker_0, id: 892a8f1a58c5</p>
            <p>stopped container sqream_single_host_master, id: 55cb7e38eb22</p>
        </div>
        <h5>Sqream Editor</h5>
        <p>Start SQream SQL Statement Editor</p>
        <p><span class="codeCH">sqream editor --start</span>
        </p>
        <div class="code">
            <p>sqream-console&gt;sqream editor --start</p>
            <p>access sqream statement editor on your chrome web browser http://192.168.0.220:3000</p>
            <p>Stop SQream editor</p>
        </div>
        <p><span class="codeCH">sqream editor --stop</span>
        </p>
        <div class="code">
            <p>sqream-console&gt;sqream editor --stop</p>
            <p>stopped sqream_editor</p>
        </div>
        <h5>SQream-Client</h5>
        <p>To use the embedded SQream Client on the master node:</p>
        <ul>
            <li>
                <p>Default port 3108, use -p for other master port.</p>
            </li>
            <li>
                <p>Default database is master, use -d for different  database ) :</p>
            </li>
        </ul>
        <div class="code">
            <p>sqream client --master -u sqream -w sqream</p>
        </div>
        <p>To use the embedded SQream Client on worker node(s):</p>
        <ul>
            <li>
                <p>Default port 5000, use -p for other worker port.</p>
            </li>
            <li>
                <p>Default database  is master, use -d for a  different database )</p>
            </li>
        </ul>
        <div class="code">
            <p>sqream client --worker -u sqream -w sqream</p>
        </div>
    </body>
</html>